Problem:
Functional requirements: 
User should be able to create, read, update, and deelete a google docs from their web browser
Users should be able to view changes on and edit a google docs owned by a different user concurrently 
Scale Requirements:
DAU: 1 million 
Traffic spike: 5x during peak hour
Avg document size: 100KB
Edit frequency: 1 edit per second
Up to 100 concurrent Users
Non Functional:
Hihgly available low latency, eventual consistency, Read-your-writes-consistency

High Level Design 
Document File URL structure: we would not use a directory file url structure as we do not want to expose collaborators to different file in the subdirectory
This is why we use a flat file structure

Store Documents: Metadata 
We will need to have fast queries and filtering
We will need to maintain data integrity: we want to make sure metadata is consistent and accurate
We also need transactional consistency
We will need a relational database

Storing Documents: Document Content 
Larger and less structured than metadata for text, images and othe rich media. 
Version History 
This is why we need to use cloud object storages 
- They can handle alot of unstructured data
- They are optimized for high throughput, scalability and durability.
- Cost effective

How to represent document content:
- Document content is rich -> contains bold, italic, underline
- May contain images, videos
- Users need to be able to edit the document content is high granularity 
- User also need to be able to bulk edit the document

Top level:
document: {
    title: String,
    documentId: String,
    body: Body
}

Body: {
    StructuralElement: {
        Paragraph: {
            ParagraphStyle
            Bullet
            ParagraphElement {
                TextRun (text with same styling)
                AutoText
                PageBreak
                ColumnBreak
                Equation
            }
        }
    }
    Table
    TableOfContents
    SectionBreak
    
}

Multi-user collaboratorive editing 
- Users shoudl be able to edit the same document concurrently and view each other's changes in real time 
We have to handle synchronizating of the document state for different Users
We have to handle conflicts when multiple users edit the same document 

HTTP Polling 
- Client periodically requests updates form server
Pros: Simple to implement, works with standard http infa, supports all browsers
Cons: High latency, server overhead, bandwidth intensive

Websocket:
- Persistent bidirection connection between client and server
- Pros: Low Latency, effecient, bidirectional, reduced server load compared to Polling
- Cons: More complex to implement, requires websocket-specific infa, need ot handle connect management and reconnection

Sever Sent Events 
- Server pushes updates to client over HTTP
- Pros: real time updates, works over standard http, automatic reconnection, simpler than Websocket
- Cons: one-way communication only, limited browser support, may require additional mechanism for client to serve updates



Winner: Websocket as it is the best for real time collaborative ediitng. We can add this service in front of docuemnt service to support bidirection communication. 
Message queue between document service and websocket service to decouple them and improve the availability and reliability of the document service. 